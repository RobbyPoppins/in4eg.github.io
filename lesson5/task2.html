<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		.col {
			display: inline-block;
		}
		.item {
			display: block;
			width: 40px; height: 15px;
			border: 1px solid #ddd;
			margin: -1px 0 0 -1px;
		}
		.item.active {
			background: #999;
			border-color: #888;
		}
		.item.water {
			background: #59b;
			border-color: #48a;
		}
	</style>
</head>
<body>

	<script>
		var array, cache, calculate, drawCol, makeWater;

		Array.prototype.max = function() {
			return Math.max.apply(null, this);
		};
		Array.prototype.min = function() {
			return Math.min.apply(null, this);
		};

		array = [2, 1, 5, 0, 3, 4, 7, 2, 3, 1, 0];
		water = [];

		a1 = null
		a2 = null

		makeWater = function(val, indx) {
			if (a1 !== null){
				if (a2 !== null){
					if (
						(array[a2] <= array[indx]) || a2 === null
					){
						a2 = indx;
						array.slice(a1, a2+1).map(function(_val, _indx){
							if (array[a1] > _val && _val < array[a2]){
								water.push({min: a1, max: a2, indx: _indx})
							}
						});
						// console.log(a1 +'...'+ a2, '\n\n\n')
						a1 = null
						a2 = null
					}
				} else {
					a2 = indx;
				}
			} else {
				a1 = indx;
			}
		};

		drawCol = function(val, max, indx) {
			var i, str;
			str = '';
			i = 0;
			makeWater(val, indx);
			while (i < max + 1) {
				str += '<span class="item ' + (max - i < val ? 'active' : '') + '"></span>';
				i++;
			}
			return "<span class='col'>" + str + "</span>";
		};

		calculate = function(arr) {
			var max, res;
			max = arr.max();
			res = '';
			arr.map(function(val, indx) {
				return res += drawCol(val, max, indx);
			});
			document.body.innerHTML = res;
			water.map(function(w){
				col = document.querySelectorAll('.col:nth-child('+(w.indx+1)+')')[0]
				wat = col.querySelectorAll('.item')
				// console.log(wat)
				// wat.forEach(function(item, _i){
				// 	if (max-1-_i <= array[w.indx].min()){
				// 		item.classList.add('water')
				// 	}
				// });
			});
		};

		calculate(array);
	</script>
</body>
</html>